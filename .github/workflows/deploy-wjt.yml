#26
# TODO - nx docker-build wjt
# TODO - push to Docker Hub
# TODO - SSH into wjt-prod
# TODO - Run `wjtr` alias
on:
  push:
    tags:
      - '**'
  workflow_dispatch:

  jobs:
    deploy-wjt:
      name: Deploy WJT
      runs-on: ubuntu-latest
      permissions:
        contents: read
        packages: write
        repository_hooks: write
        pull_requests: write
      steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            fetch-depth: 0

        - name: Cache node_modules
          uses: actions/cache@v2
          with:
            node-version: 20
            cache: 'npm'

        - run: npm ci --legacy-peer-deps
        - uses: nrwl/nx-set-shas@v4

        - name: Login to Docker Hub
          uses: docker/login-action@v3
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}

        - run: docker search wijohnst/wjt:latest
